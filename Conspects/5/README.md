# Лекция 5: Node.js

## Поиск сервера
Работу сайта обеспечивает сервер. У сервера есть адрес - IP-адрес.
Такая информация хранится в распределенной системе серверов — DNS (Domain Name System). Система работает как общая «контактная книга», хранящаяся на распределенных серверах и устройствах в интернете.


## TCP-соединение
После получения IP-адреса браузер устанавливает соединение с сервером через протокол TCP. Процесс включает три шага (трехэтапное рукопожатие):
1. **SYN** — запрос на установку соединения от клиента.
2. **SYN/ACK** — подтверждение от сервера.
3. **ACK** — окончательное подтверждение от клиента.

## Клиент-серверная модель
Архитектура, где задачи распределены между серверами (поставщики услуг) и клиентами (заказчики услуг). Примеры клиентов: ПК, смартфоны, ноутбуки.

## Веб-страницы и серверный рендеринг
- **Статические страницы**: Отображаются браузером без изменений (HTML, CSS).
- **SSR (Server Side Rendering)**: Сервер генерирует динамические страницы, обрабатывает запросы и взаимодействует с базой данных.

## Веб-приложения и REST
- **Frontend**: Генерация интерфейса, взаимодействие с пользователем, запросы к API.
- **Backend**: Реализация API, работа с базой данных.
- **REST**: Каждый запрос содержит всю необходимую информацию для выполнения действия сервером.

## Node.js
Среда выполнения JavaScript на движке V8. Используется для:
- Веб-приложений (бэкенд).
- Десктопных приложений (Electron.js).
- Микроконтроллеров (Espurino).
- Консольных утилит.
- Машинного обучения (TensorFlow.js).

### Преимущества Node.js
- Высокая производительность.
- Асинхронное API (не блокирует основной поток).
- Простота создания веб-серверов (15 строк кода).
- Поддержка различных парадигм программирования.

### Проблемы JavaScript
- Отсутствие строгой типизации.
- Runtime-ошибки.
- Отсутствие многопоточности.
- Медленные вычисления.

## Использование Node.js
1. Создать файл `.js`.
2. Написать код.
3. Запустить командой `node <файл>.js`.
4. Обратиться по HTTP.

Пример сервера:
```javascript
const http = require("http");
const HOST = 'localhost';
const PORT = 8000;

const handler = (req, res) => {
    res.writeHead(200);
    res.end('JavaScript - классный язык программирования!');
};

const server = http.createServer(handler);
server.listen(PORT, HOST, () => {
    console.log(`Сервер запущен по адресу http://${HOST}:${PORT}`);
});
```

## Стандартная библиотека Node.js
- `events`: EventEmitter.
- `fs`: работа с файловой системой.
- `os`: взаимодействие с ОС.
- `http`: создание HTTP-серверов.
- `net`: низкоуровневое сетевое соединение.
- `path`: работа с путями.

## Nest.js
Фреймворк для создания серверных приложений на TypeScript. Преимущества:
- Готовая архитектура.
- Встроенные решения для middleware.
- Удобная валидация.
- Поддержка gRPC.
- Dependency Injection.

## TypeScript
Надмножество JavaScript с статической типизацией. Преимущества:
- Аннотации типов.
- Интерфейсы, кортежи, декораторы.
- Поддержка IDE и автодополнения.
- Совместимость с JavaScript.

## Лабораторная работа
Задание: реализовать CRUD-операции для карточек акций:
- `GET /stocks/` — получить все карточки.
- `POST /stocks` — создать новую карточку.
- `GET /stocks/:id` — получить карточку по ID.
- `PATCH /stocks/:id` — обновить карточку по ID.
- `DELETE /stocks/:id` — удалить карточку по ID.

## Postman
Инструмент для тестирования API. Пример использования:
- Отправка JSON для создания новой записи.
- Проверка ответов сервера.

## Модель и контроллер в NestJS
- **Модель**: Данные хранятся в массиве или файле. Логика работы с данными реализуется в сервисе.
- **Контроллер**: Обрабатывает HTTP-запросы и взаимодействует с сервисом.

Пример сервиса:
```typescript
@Injectable()
export class StocksService {
    constructor(private fileService: FileService<Stock[]>) {}

    create(createStockDto: CreateStockDto) {
        const stocks = this.fileService.read();
        const stock = { ...createStockDto, id: stocks.length + 1 };
        this.fileService.add(stock);
    }

    findAll(): Stock[] {
        return this.fileService.read();
    }
}
```

Пример контроллера:
```typescript
@Controller('stocks')
export class StocksController {
    constructor(private readonly stocksService: StocksService) {}

    @Post()
    create(@Body() createStockDto: CreateStockDto) {
        return this.stocksService.create(createStockDto);
    }

    @Get()
    findAll() {
        return this.stocksService.findAll();
    }
}
```
